import{c as e,e as a,l,d as t,r as o,S as i,o as s,b8 as r,Y as n,w as d,g as u,X as m,a1 as p,W as c,m as f,aQ as v,Z as g,ay as h,aH as _,bV as y,$ as b,a0 as j}from"./index.V7TsgTEq.js";import{v as k}from"./el-loading.CUKFIxyY.js";import{a as V}from"./el-scrollbar.Dfe8YXkA.js";import{E as x}from"./el-tree.DDr3oK1M.js";import"./el-checkbox.CWpy68J6.js";import{E as C}from"./el-dialog.BeGVJrgV.js";import{E as w}from"./el-card.BJ4uZ2ka.js";import{_ as U}from"./index.DDhQ4iwa.js";import{E as z,a as E}from"./el-table-column.BFVhfB4m.js";import"./el-tooltip.l0sNRNKZ.js";import{_ as N}from"./edit.BUtFv85l.js";/* empty css               */import{_ as R}from"./delete.BIGVJTzd.js";import{_ as F}from"./plus.5OPls1xN.js";import{E as S,a as T}from"./el-form.DDV5Rp5a.js";import{_ as q,a as B}from"./search.CXprqqln.js";import"./el-form-item.l0sNRNKZ.js";import{g as A,u as L,a as O,d as P,b as H,c as W}from"./index.2mNrNrPo.js";import"./isUndefined.DgmxjSXK.js";import"./index.DixU4aO5.js";import"./isEqual.D_Din47F.js";import"./_initCloneObject.BGweDbMt.js";import"./refs.acExKAza.js";import"./el-select.C7IgsXi3.js";import"./index.CoRC1ks8.js";import"./strings.Bv4Mk_5L.js";import"./_baseIteratee.Br-040dN.js";import"./index.Dr-8d26T.js";import"./castArray.BrIbwm_9.js";import"./_plugin-vue_export-helper.BCo6x5W8.js";const D={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},I=[l("path",{fill:"currentColor",d:"m249.6 417.088l319.744 43.072l39.168 310.272L845.12 178.88zm-129.024 47.168a32 32 0 0 1-7.68-61.44l777.792-311.04a32 32 0 0 1 41.6 41.6l-310.336 775.68a32 32 0 0 1-61.44-7.808L512 516.992z"},null,-1)];const J={name:"ep-position",render:function(l,t){return e(),a("svg",D,[...I])}},K={class:"app-container"},M={class:"search-container"},Q={class:"dialog-footer"},X={class:"dialog-footer"},Y=t({name:"Role",inheritAttrs:!1,__name:"role",setup(t){const D=o(S),I=o(S),Y=o(x),Z=o(!1),$=o([]),G=o(0),ee=i({pageNo:1,pageSize:10}),ae=o(),le=i({title:"",visible:!1}),te=i({code:"",name:"",remarks:""}),oe=i({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]}),ie=o(!1),se=o([]);let re=i({});function ne(){Z.value=!0,A(ee).then((({data:e})=>{ae.value=e.records,G.value=e.total})).finally((()=>{Z.value=!1}))}function de(){D.value.resetFields(),ee.pageNo=1,ne()}function ue(e){$.value=e.map((e=>e.id))}function me(e){le.visible=!0,e?(le.title="修改角色",Object.assign(te,e)):le.title="新增角色"}function pe(){I.value.validate((e=>{if(e){Z.value=!0;te.id?L(te).then((()=>{h.success("修改成功"),ce(),de()})).finally((()=>Z.value=!1)):O(te).then((()=>{h.success("新增成功"),ce(),de()})).finally((()=>Z.value=!1))}}))}function ce(){le.visible=!1,I.value.resetFields(),I.value.clearValidate(),te.id=void 0,te.name="",te.code="",te.remarks=""}function fe(e){const a=o([]);e&&a.value.push(e),$.value.length&&(a.value=$.value),a?_.confirm("确认删除已选中的数据项?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{Z.value=!0,P(a.value).then((()=>{h.success("删除成功"),de()})).finally((()=>Z.value=!1))})):h.warning("请勾选删除项")}function ve(){const e=re.id;if(e){const a=Y.value.getCheckedNodes(!1,!0).map((e=>e.value));Z.value=!0,W(e,a).then((()=>{h.success("分配权限成功"),ie.value=!1,de()})).finally((()=>{Z.value=!1}))}}return s((()=>{ne()})),(t,o)=>{const i=b,s=T,h=q,_=j,A=B,L=S,O=F,P=R,W=z,ge=J,he=N,_e=E,ye=U,be=w,je=C,ke=x,Ve=V,xe=r("hasPerm"),Ce=k;return e(),a("div",K,[l("div",M,[n(L,{ref_key:"queryFormRef",ref:D,model:u(ee),inline:!0},{default:d((()=>[n(s,{prop:"name",label:"关键字"},{default:d((()=>[n(i,{modelValue:u(ee).name,"onUpdate:modelValue":o[0]||(o[0]=e=>u(ee).name=e),placeholder:"角色名称",clearable:"",onKeyup:m(ne,["enter"])},null,8,["modelValue"])])),_:1}),n(s,null,{default:d((()=>[n(_,{type:"primary",onClick:ne},{default:d((()=>[n(h),p("搜索")])),_:1}),n(_,{onClick:de},{default:d((()=>[n(A),p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),n(be,{shadow:"never",class:"table-container"},{header:d((()=>[c((e(),f(_,{type:"success",onClick:o[1]||(o[1]=e=>me())},{default:d((()=>[n(O),p("新增")])),_:1})),[[xe,["system:role:add"]]]),c((e(),f(_,{type:"danger",disabled:0===u($).length,onClick:o[2]||(o[2]=e=>fe())},{default:d((()=>[n(P),p("批量删除")])),_:1},8,["disabled"])),[[xe,["system:role:delete"]]])])),default:d((()=>[c((e(),f(_e,{ref:"dataTableRef",data:u(ae),"highlight-current-row":"",stripe:"",fit:"",onSelectionChange:ue},{default:d((()=>[n(W,{type:"selection",width:"55",align:"center"}),n(W,{label:"角色名称",align:"center",prop:"name"}),n(W,{label:"角色编码",align:"center",prop:"code"}),n(W,{label:"备注",align:"center",prop:"remarks"}),n(W,{label:"创建时间",align:"center",width:"200",prop:"createTime"}),n(W,{fixed:"right",align:"center",label:"操作",width:"220"},{default:d((a=>[c((e(),f(_,{type:"success",size:"small",link:"",onClick:e=>function(e){const a=e.id;a&&(re={id:a,name:e.name},ie.value=!0,Z.value=!0,y().then((e=>{se.value=e.data,H(a).then((({data:e})=>{e.forEach((e=>Y.value.setChecked(e,!0,!1)))})).finally((()=>{Z.value=!1}))})))}(a.row)},{default:d((()=>[n(ge),p("分配权限 ")])),_:2},1032,["onClick"])),[[xe,["system:role:assign"]]]),c((e(),f(_,{type:"primary",size:"small",link:"",onClick:e=>me(a.row)},{default:d((()=>[n(he),p("编辑 ")])),_:2},1032,["onClick"])),[[xe,["system:role:update"]]]),c((e(),f(_,{type:"danger",size:"small",link:"",onClick:e=>fe(a.row.id)},{default:d((()=>[n(P),p("删除 ")])),_:2},1032,["onClick"])),[[xe,["system:role:delete"]]])])),_:1})])),_:1},8,["data"])),[[Ce,u(Z)]]),u(G)>0?(e(),f(ye,{key:0,total:u(G),"onUpdate:total":o[3]||(o[3]=e=>v(G)?G.value=e:null),page:u(ee).pageNo,"onUpdate:page":o[4]||(o[4]=e=>u(ee).pageNo=e),limit:u(ee).pageSize,"onUpdate:limit":o[5]||(o[5]=e=>u(ee).pageSize=e),onPagination:ne},null,8,["total","page","limit"])):g("",!0)])),_:1}),n(je,{modelValue:u(le).visible,"onUpdate:modelValue":o[9]||(o[9]=e=>u(le).visible=e),title:u(le).title,width:"500px",onClose:ce},{footer:d((()=>[l("div",Q,[n(_,{type:"primary",onClick:pe},{default:d((()=>[p("确 定")])),_:1}),n(_,{onClick:ce},{default:d((()=>[p("取 消")])),_:1})])])),default:d((()=>[n(L,{ref_key:"roleFormRef",ref:I,model:u(te),rules:u(oe),"label-width":"100px"},{default:d((()=>[n(s,{label:"角色名称",prop:"name"},{default:d((()=>[n(i,{modelValue:u(te).name,"onUpdate:modelValue":o[6]||(o[6]=e=>u(te).name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),n(s,{label:"角色编码",prop:"code"},{default:d((()=>[n(i,{modelValue:u(te).code,"onUpdate:modelValue":o[7]||(o[7]=e=>u(te).code=e),placeholder:"请输入角色编码"},null,8,["modelValue"])])),_:1}),n(s,{label:"角色备注",prop:"remarks"},{default:d((()=>[n(i,{modelValue:u(te).remarks,"onUpdate:modelValue":o[8]||(o[8]=e=>u(te).remarks=e),placeholder:"请输入角色备注"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),n(je,{modelValue:u(ie),"onUpdate:modelValue":o[11]||(o[11]=e=>v(ie)?ie.value=e:null),title:"【"+u(re).name+"】权限分配",width:"800px"},{footer:d((()=>[l("div",X,[n(_,{type:"primary",onClick:ve},{default:d((()=>[p("确 定")])),_:1}),n(_,{onClick:o[10]||(o[10]=e=>ie.value=!1)},{default:d((()=>[p("取 消")])),_:1})])])),default:d((()=>[c((e(),f(Ve,{"max-height":"600px"},{default:d((()=>[n(ke,{ref_key:"menuRef",ref:Y,"node-key":"value","show-checkbox":"",data:u(se),"default-expand-all":!0},null,8,["data"])])),_:1})),[[Ce,u(Z)]])])),_:1},8,["modelValue","title"])])}}});export{Y as default};
